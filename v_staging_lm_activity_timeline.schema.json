{"kind":"bigquery#table","etag":"yUfrhGmxoX0KY9V8FAKfCg==","id":"www-prod-389819:mlo_kpi.v_staging_lm_activity_timeline","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/www-prod-389819/datasets/mlo_kpi/tables/v_staging_lm_activity_timeline","tableReference":{"projectId":"www-prod-389819","datasetId":"mlo_kpi","tableId":"v_staging_lm_activity_timeline"},"schema":{"fields":[{"name":"id","type":"STRING"},{"name":"type","type":"STRING"},{"name":"activity_key","type":"STRING"},{"name":"attributes_created_at","type":"TIMESTAMP"},{"name":"attributes_updated_at","type":"TIMESTAMP"},{"name":"event_name","type":"STRING"},{"name":"event_start_date","type":"TIMESTAMP"},{"name":"event_end_date","type":"TIMESTAMP"},{"name":"contact_first_name","type":"STRING"},{"name":"contact_last_name","type":"STRING"},{"name":"contact_email","type":"STRING"},{"name":"activity_status","type":"STRING"},{"name":"action_node_name","type":"STRING"},{"name":"body_text_preview","type":"STRING"},{"name":"email_subject","type":"STRING"},{"name":"parsed_detail_keys_json","type":"STRING"},{"name":"owner_id","type":"STRING"},{"name":"owner_type","type":"STRING"},{"name":"recipient_id","type":"STRING"},{"name":"recipient_type","type":"STRING"},{"name":"tracked_id","type":"STRING"},{"name":"tracked_type","type":"STRING"}]},"numBytes":"0","numLongTermBytes":"0","numRows":"0","creationTime":"1757815334537","lastModifiedTime":"1757815334537","type":"VIEW","view":{"query":"SELECT\n    t.id,\n    t.type,\n    JSON_VALUE(t.attributes, '$.key') AS activity_key,\n    SAFE_CAST(JSON_VALUE(t.attributes, '$.created_at') AS TIMESTAMP) AS attributes_created_at,\n    SAFE_CAST(JSON_VALUE(t.attributes, '$.updated_at') AS TIMESTAMP) AS attributes_updated_at,\n\n    -- Dynamic parsing of 'detail_keys' based on 'activity_key'\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'appointment_event.create' THEN JSON_VALUE(t.attributes, '$.detail_keys.name')\n        WHEN 'appointment_event.update' THEN JSON_VALUE(t.attributes, '$.detail_keys.name')\n        ELSE NULL\n    END AS event_name,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'appointment_event.create' THEN SAFE_CAST(JSON_VALUE(t.attributes, '$.detail_keys.start_date') AS TIMESTAMP)\n        ELSE NULL\n    END AS event_start_date,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'appointment_event.create' THEN SAFE_CAST(JSON_VALUE(t.attributes, '$.detail_keys.end_date') AS TIMESTAMP)\n        ELSE NULL\n    END AS event_end_date,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'contact.create' THEN JSON_VALUE(t.attributes, '$.detail_keys[0].contact[1].first_name')\n        ELSE NULL\n    END AS contact_first_name,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'contact.create' THEN JSON_VALUE(t.attributes, '$.detail_keys[0].contact[2].last_name')\n        ELSE NULL\n    END AS contact_last_name,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'contact.create' THEN JSON_VALUE(t.attributes, '$.detail_keys[1].emails[0].info[1]')\n        ELSE NULL\n    END AS contact_email,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'automation.exited' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'automation.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'automation.initialized' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'automation.loaded' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'automation.restarted' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'automation.resumed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'automation.retried' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'branch_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'branch_else_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'branch_if_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'change_attributes_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'convert_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_document_instance.completed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_document_instance.expired' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_document_instance.re_sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_document_instance.sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_document_instance.submitted' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_document_instance.viewed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_form_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'custom_form_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'delay_action_node.awaiting_delivery_window' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'delay_action_node.started' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'email_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'email_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'prospect.convert' THEN JSON_VALUE(t.attributes, '$.detail_keys[0].prospect[2].status')\n        WHEN 'prospect.update' THEN JSON_VALUE(t.attributes, '$.detail_keys[0].prospect[1].status')\n        WHEN 'task.complete' THEN JSON_VALUE(t.attributes, '$.detail_keys.done')\n        WHEN 'task_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        WHEN 'task_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.status')\n        ELSE NULL\n    END AS activity_status,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'automation.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'automation.initialized' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'automation.restarted' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'automation.resumed' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'automation.retried' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'branch_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'branch_else_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'branch_if_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'change_attributes_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'convert_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'custom_form_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'custom_form_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'delay_action_node.awaiting_delivery_window' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'delay_action_node.started' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'email_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'email_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'task_action_node.failed' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        WHEN 'task_action_node.finished' THEN JSON_VALUE(t.attributes, '$.detail_keys.action_node.name')\n        ELSE NULL\n    END AS action_node_name,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'comment.created' THEN JSON_VALUE(t.attributes, '$.detail_keys.comment')\n        WHEN 'comment.deleted' THEN JSON_VALUE(t.attributes, '$.detail_keys.comment')\n        WHEN 'comment.updated' THEN JSON_VALUE(t.attributes, '$.detail_keys.comment')\n        WHEN 'note.create' THEN JSON_VALUE(t.attributes, '$.detail_keys.body')\n        WHEN 'note.update' THEN JSON_VALUE(t.attributes, '$.detail_keys.body')\n        WHEN 'custom_email.queued' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        WHEN 'custom_email.sent' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        WHEN 'email.queued' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        WHEN 'email.sent' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        WHEN 'quick_send_email.queued' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        WHEN 'quick_send_email.sent' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        WHEN 'reminder_email.sent' THEN SUBSTR(JSON_VALUE(t.attributes, '$.detail_keys.body'), 1, 500) -- Truncate body\n        ELSE NULL\n    END AS body_text_preview,\n\n    CASE JSON_VALUE(t.attributes, '$.key')\n        WHEN 'custom_email.queued' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'custom_email.sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'email.queued' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'email.sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'quick_send_email.queued' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'quick_send_email.sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'reminder_email.sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'email_thread.create' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'external_email.received' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        WHEN 'external_email.sent' THEN JSON_VALUE(t.attributes, '$.detail_keys.subject')\n        ELSE NULL\n    END AS email_subject,\n\n    -- Generic JSON extraction for `detail_keys` when specific parsing is not implemented\n    JSON_EXTRACT(t.attributes, '$.detail_keys') AS parsed_detail_keys_json,\n\n    -- Specific relationships extraction (now directly from structs)\n    t.owner.data.id AS owner_id,\n    t.owner.data.type AS owner_type,\n    t.recipient.data.id AS recipient_id,\n    t.recipient.data.type AS recipient_type,\n    t.tracked.data.id AS tracked_id,\n    t.tracked.data.type AS tracked_type\n\nFROM\n    `www-prod-389819.mlo_kpi.lawmatics_activity_timeline_raw_retrieval` AS t\nWHERE\n    t.type = 'timeline_activity'","useLegacySql":false},"location":"US","numTotalLogicalBytes":"0","numActiveLogicalBytes":"0","numLongTermLogicalBytes":"0"}
